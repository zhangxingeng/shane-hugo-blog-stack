{{- $query := first 1 (where .Context.Site.Pages "Layout" "==" "archives") -}}
{{- $context := .Context -}}
{{- $limit := default 5 .Params.limit -}}
{{- if $query -}}
    {{- $archivesPage := index $query 0 -}}
    <section class="bg-card-bg rounded-card p-card shadow-l1 mb-widget archives">
        <div class="text-accent mb-4">
            {{ partial "helper/icon" "infinity" }}
        </div>
        <h2 class="text-xl font-semibold text-card-text mb-4">{{ T "widget.archives.title" }}</h2>

        {{ $pages := where $context.Site.RegularPages "Type" "in" $context.Site.Params.mainSections }}
        {{ $notHidden := where $context.Site.RegularPages "Params.hidden" "!=" true }}
        {{ $filtered := ($pages | intersect $notHidden) }}
        {{ $archives := $filtered.GroupByDate "2006" }}
        
        <div class="space-y-3">
            {{ range $index, $item := first (add $limit 1) ($archives) }}
                {{- $id := lower (replace $item.Key " " "-") -}}
                <div class="group">
                    <a href="{{ $archivesPage.RelPermalink }}#{{ $id }}" class="block p-3 rounded-lg border-l-4 border-accent bg-gradient-to-r from-accent/5 to-transparent hover:from-accent/10 hover:shadow-md transition-all duration-300 hover:translate-x-1">
                        {{ if eq $index $limit }}
                            <div class="flex items-center justify-between">
                                <span class="font-semibold text-card-text group-hover:text-accent transition-colors duration-200">{{ T "widget.archives.more" }}</span>
                                <svg class="w-4 h-4 text-card-text-tertiary group-hover:text-accent transition-all duration-200 transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                            </div>
                        {{ else }}
                            <div class="flex items-center justify-between">
                                <span class="font-semibold text-card-text group-hover:text-accent transition-colors duration-200">{{ .Key }}</span>
                                <span class="text-sm text-card-text-tertiary bg-card-bg-selected px-3 py-1 rounded-full font-medium group-hover:bg-accent group-hover:text-accent-text transition-all duration-200">{{ len $item.Pages }}</span>
                            </div>
                        {{ end }}
                    </a> 
                </div>
            {{ end }}
        </div>
    </section>
{{- else -}}
    {{- warnf "Archives page not found. Create a page with layout: archives." -}}
{{- end -}}