{{- $context := .Context -}}
{{- $limit := default 5 .Params.limit -}}
<section class="bg-card-bg rounded-card p-card shadow-l1 mb-widget archives-widget">
    <div class="text-accent mb-4">
        {{ partial "helper/icon" "infinity" }}
    </div>
    <h2 class="text-xl font-semibold text-card-text mb-4">{{ T "widget.archives.title" }}</h2>

    {{ $pages := where $context.Site.RegularPages "Type" "in" $context.Site.Params.mainSections }}
    {{ $notHidden := where $context.Site.RegularPages "Params.hidden" "!=" true }}
    {{ $filtered := ($pages | intersect $notHidden) }}
    {{ $archives := $filtered.GroupByDate "2006" }}
    
    <div class="space-y-2">
        {{ range $index, $item := first $limit $archives }}
            <div class="flex items-center justify-between py-2 px-3 rounded-card text-card-text-secondary hover:bg-card-bg-selected hover:text-card-text transition-all duration-200 group">
                <span class="text-sm font-medium">{{ .Key }}</span>
                <span class="text-xs text-card-text-tertiary bg-card-bg-selected px-2 py-1 rounded-tag group-hover:bg-accent group-hover:text-accent-text transition-all duration-200">{{ len $item.Pages }}</span>
            </div>
        {{ end }}
        
        {{- if gt (len $archives) $limit -}}
            <div class="pt-2 border-t border-card-separator">
                <div class="flex items-center justify-center py-2 px-3 rounded-card text-card-text-tertiary hover:text-accent transition-colors duration-200 text-xs font-medium">
                    {{ T "widget.archives.more" | default "More archives" }}
                    <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>
        {{- end -}}
    </div>
</section>