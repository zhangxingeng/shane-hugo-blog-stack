{{/* Series navigation and information partial */}}
{{ if .Params.series }}
    {{ range (.GetTerms "series") }}
        <div class="bg-card-bg rounded-card p-6 my-8 border-l-4 border-accent shadow-l1">
            <div class="mb-4">
                <span class="inline-block px-3 py-1 bg-accent text-accent-text text-sm font-semibold rounded-tag mb-2">Series</span>
                <h4 class="text-lg font-semibold text-card-text">
                    <a href="{{ .Permalink }}" class="hover:text-accent transition-colors duration-200">{{ .LinkTitle }}</a>
                </h4>
            </div>
            
            {{/* Get all posts in this series */}}
            {{ $seriesPosts := .Pages.ByDate }}
            {{ $currentPost := $.Page }}
            
            {{/* Find current post index and get prev/next */}}
            {{ $currentIndex := 0 }}
            {{ $prevPost := false }}
            {{ $nextPost := false }}
            
            {{ range $index, $post := $seriesPosts }}
                {{ if eq $post.Permalink $currentPost.Permalink }}
                    {{ $currentIndex = $index }}
                    {{ if gt $index 0 }}
                        {{ $prevPost = index $seriesPosts (sub $index 1) }}
                    {{ end }}
                    {{ if lt $index (sub (len $seriesPosts) 1) }}
                        {{ $nextPost = index $seriesPosts (add $index 1) }}
                    {{ end }}
                {{ end }}
            {{ end }}
            
            {{/* Navigation buttons */}}
            {{ if or $prevPost $nextPost }}
                <div class="flex flex-col sm:flex-row gap-4 mt-4">
                    {{ if $prevPost }}
                        <a href="{{ $prevPost.Permalink }}" class="flex-1 p-4 bg-card-bg-selected rounded-card text-center hover:bg-accent hover:text-accent-text transition-all duration-200 group">
                            <span class="block text-sm font-semibold mb-1">← Previous</span>
                            <span class="block text-card-text-secondary group-hover:text-inherit">{{ $prevPost.Title }}</span>
                        </a>
                    {{ end }}
                    
                    {{ if $nextPost }}
                        <a href="{{ $nextPost.Permalink }}" class="flex-1 p-4 bg-card-bg-selected rounded-card text-center hover:bg-accent hover:text-accent-text transition-all duration-200 group">
                            <span class="block text-sm font-semibold mb-1">Next →</span>
                            <span class="block text-card-text-secondary group-hover:text-inherit">{{ $nextPost.Title }}</span>
                        </a>
                    {{ end }}
                </div>
            {{ end }}
            
            {{/* Collapsible series list */}}
            <details class="mt-4 border-t border-card-separator pt-4">
                <summary class="cursor-pointer text-sm font-medium text-card-text-secondary hover:text-accent transition-colors duration-200 select-none">
                    View all {{ len $seriesPosts }} posts in this series
                </summary>
                <ol class="mt-3 space-y-2 text-sm">
                    {{ range $index, $post := $seriesPosts }}
                        <li class="flex items-start gap-2">
                            <span class="text-card-text-tertiary font-mono text-xs mt-0.5">{{ add $index 1 }}.</span>
                            {{ if eq $post.Permalink $currentPost.Permalink }}
                                <span class="font-semibold text-accent">{{ $post.Title }} (current)</span>
                            {{ else }}
                                <a href="{{ $post.Permalink }}" class="text-card-text-secondary hover:text-accent transition-colors duration-200">{{ $post.Title }}</a>
                            {{ end }}
                        </li>
                    {{ end }}
                </ol>
            </details>
        </div>
    {{ end }}
{{ end }} 